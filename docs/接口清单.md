# starry-blog 项目 · 登录 / 注册 / 令牌 / 用户 / 密码

### Auth 鉴权接口总览（9 个）
```
baseURL = https://apis.starrycognition.cn
通用返回格式
{
  "code": 200 | 400 | 401 | 404,
  "message": "文字提示",
  "data": any
}
```

---

#### 1. 发送登录验证码
```
POST /api/login/code
Content-Type: application/json

Body
{
  "email": string 必填 样例 "starry@qq.com"
}

成功 200
{
  "code": 200,
  "message": "验证码已发送"
}

高频错误
400  "邮箱格式错误"
```

---

#### 2. 校验验证码并颁发 JWT（邮箱登录）
```
POST /api/login/verify
Content-Type: application/json

Body
{
  "email": string 必填 样例 "starry@qq.com",
  "code":  string 必填 样例 "123456"
}

成功 200
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "jwt": "eyJhbGc..."   // accessToken，7 天
  }
}

高频错误
400  "邮箱和验证码必填"
400  "验证码错误或已过期"
```

---

#### 3. 用户注册
```
POST /api/auth/register
Content-Type: application/json

Body
{
  "username": string 必填 3-20 位 样例 "starry",
  "password": string 必填 ≥6 位 样例 "123456",
  "email":    string 必填 邮箱格式 样例 "starry@qq.com",
  "phone":    string 可选 7-15 位数字 样例 "13800138000",
  "role":     string 可选 枚举 user|admin|vip 默认 "user"
}

成功 201
{
  "code": 201,
  "message": "注册成功",
  "data": { "id": 12 }
}

高频错误
400  "用户名、密码、邮箱必填"
400  "用户名 3-20 位"
400  "密码至少 6 位"
400  "邮箱格式错误"
400  "用户名已存在"
400  "邮箱已注册"
```

---

#### 4. 用户名密码登录
```
POST /api/auth/login
Content-Type: application/json

Body
{
  "username": string 必填 样例 "starry",
  "password": string 必填 样例 "123456"
}

成功 200
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "jwt": "eyJhbGc..."          // accessToken  7 天
    "refreshToken": "eyJhbGc..." // refreshToken 30 天
    "username": "starry",
    "email": "starry@qq.com",
    "role": "user"
  }
}

高频错误
400  "用户名和密码必填"
400  "用户不存在或密码错误"
```

---

#### 5. 刷新访问令牌
```
POST /api/auth/refresh
Content-Type: application/json

Body
{
  "refreshToken": string 必填 样例 "eyJhbGc..."（>200 字符）
}

成功 200
{
  "code": 200,
  "message": "刷新成功",
  "data": { "jwt": "eyJhbGc..." /* 新的 accessToken */ }
}

高频错误
401  "未提供刷新令牌"
401  "刷新令牌无效或过期"
```

---

#### 6. 获取个人信息
```
GET /api/me
Headers
Authorization: Bearer <jwt>

Query 可选（兼容 URL 传 token）
?token=<jwt>

成功 200
{
  "code": 200,
  "message": "成功",
  "data": {
    "id": 1,
    "username": "starry",
    "email": "starry@qq.com",
    "phone": "13800138000",
    "role": "user",
    "created_at": 1710000000000,
    "updated_at": 1710000000000
  }
}

高频错误
401  "未登录"
401  "Token 无效"
404  "用户不存在"
```

---

#### 7. 修改个人信息
```
POST /api/me/update
Headers
Authorization: Bearer <jwt>
Content-Type: application/json

Body（全字段可选，至少传一项）
{
  "username": string 可选 3-20 位,
  "password": string 可选 ≥6 位,
  "email":    string 可选 邮箱格式,
  "phone":    string 可选 7-15 位数字,
  "role":     string 可选 user|admin|vip
}

成功 200
{
  "code": 200,
  "message": "资料更新成功"
}

高频错误
400  "没有提供可更新的字段"
401  "未登录" / "Token 无效"
```

---

#### 8. 忘记密码 - 发送验证码
```
POST /api/auth/forgot-password
Content-Type: application/json

Body
{
  "email": string 必填 样例 "starry@qq.com"
}

成功 200
{
  "code": 200,
  "message": "验证码已发送"
}

高频错误
400  "邮箱格式错误"
```

---

#### 9. 重置密码 - 用验证码
```
POST /api/auth/reset-password
Content-Type: application/json

Body
{
  "email":    string 必填 样例 "starry@qq.com",
  "code":     string 必填 样例 "123456",
  "newPassword": string 必填 ≥6 位 样例 "654321"
}

成功 200
{
  "code": 200,
  "message": "密码重置成功"
}

高频错误
400  "邮箱、验证码、新密码必填"
400  "验证码错误或已过期"
```

---

### 使用提示（给通义灵码）
- 所有时间戳单位 **毫秒**
- 所有密码字段 **明文传输**，HTTPS 已加密
- 所有枚举 role 当前仅 `user / admin / vip`
- 刷新令牌 **30 天**，访问令牌 **7 天**
- 访问令牌过期返回 **401**，前端自动走 `/api/auth/refresh` 换新的